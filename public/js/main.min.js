let restaurants, neighborhoods, cuisines;
var newMap, markers = [];
document.addEventListener("DOMContentLoaded", e => {
  initMap(), fetchNeighborhoods(), fetchCuisines()
}), fetchNeighborhoods = (() => {
  DBHelper.fetchNeighborhoods((e, t) => {
    e ? console.error(e) : (self.neighborhoods = t, fillNeighborhoodsHTML())
  })
}), fillNeighborhoodsHTML = ((e = self.neighborhoods) => {
  const t = document.getElementById("neighborhoods-select");
  e.forEach(e => {
    const n = document.createElement("option");
    n.innerHTML = e, n.value = e, t.append(n)
  })
}), fetchCuisines = (() => {
  DBHelper.fetchCuisines((e, t) => {
    e ? console.error(e) : (self.cuisines = t, fillCuisinesHTML())
  })
}), fillCuisinesHTML = ((e = self.cuisines) => {
  const t = document.getElementById("cuisines-select");
  e.forEach(e => {
    const n = document.createElement("option");
    n.innerHTML = e, n.value = e, t.append(n)
  })
}), initMap = (() => {
  self.newMap = L.map("map", {
    center: [40.722216, -73.987501],
    zoom: 12,
    scrollWheelZoom: !1
  }), L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}", {
    mapboxToken: "pk.eyJ1IjoiemVicmlsZWUiLCJhIjoiY2ppejlzMHZvMDR0ejN3bHoyZXFub21lMCJ9.ZgeOqjoMglGD2nZS7mNOxg",
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    id: "mapbox.streets"
  }).addTo(newMap), updateRestaurants()
}), updateRestaurants = (() => {
  const e = document.getElementById("cuisines-select"),
    t = document.getElementById("neighborhoods-select"),
    n = e.selectedIndex,
    r = t.selectedIndex,
    s = e[n].value,
    a = t[r].value;
  DBHelper.fetchRestaurantByCuisineAndNeighborhood(s, a, (e, t) => {
    e ? console.error(e) : (resetRestaurants(t), fillRestaurantsHTML())
  })
}), resetRestaurants = (e => {
  self.restaurants = [], document.getElementById("restaurants-list").innerHTML = "", self.markers && self.markers.forEach(e => e.remove()), self.markers = [], self.restaurants = e
}), fillRestaurantsHTML = ((e = self.restaurants) => {
  const t = document.getElementById("restaurants-list");
  e.forEach(e => {
    t.append(createRestaurantHTML(e))
  }), addMarkersToMap()
}), createRestaurantHTML = (e => {
  const t = document.createElement("li"),
    n = document.createElement("img");
  n.className = "lazyload restaurant-img ", n.dataset.src = DBHelper.smallImageUrlForRestaurant(e), n.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==", n.alt = e.name + " Restaurant", t.append(n);
  const r = document.createElement("h2");
  r.innerHTML = e.name, r.setAttribute("aria-level", "2"), r.setAttribute("role", "heading"), t.append(r);
  const s = document.createElement("p");
  s.innerHTML = e.neighborhood, t.append(s);
  const a = document.createElement("p");
  a.innerHTML = e.address, t.append(a);
  const o = document.createElement("a");
  return o.innerHTML = "View Details", o.href = DBHelper.urlForRestaurant(e), o.setAttribute("aria-label", `More informations about ${e.name}`), t.append(o), t
}), addMarkersToMap = ((e = self.restaurants) => {
  e.forEach(e => {
    const t = DBHelper.mapMarkerForRestaurant(e, self.newMap);
    t.on("click", function () {
      window.location.href = t.options.url
    }), self.markers.push(t)
  })
}), "serviceWorker" in navigator && window.addEventListener("load", function () {
  navigator.serviceWorker.register("service-worker.js", {
    scope: "/"
  }).then(function (e) {
    console.log("ServiceWorker registration successful with scope: ", e.scope)
  }).catch(function (e) {
    console.log("ServiceWorker registration failed: error:", e)
  })
});