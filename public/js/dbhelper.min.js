class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static openDatabase(){return navigator.serviceWorker?idb.open("restaurantDb",1,function(t){t.createObjectStore("restaurantDbs",{keyPath:"id"}).createIndex("by-id","id")}):Promise.resolve()}static saveToDatabase(t){return DBHelper.openDatabase().then(function(e){if(!e)return;const a=e.transaction("restaurantDbs","readwrite"),r=a.objectStore("restaurantDbs");return t.forEach(function(t){r.put(t)}),a.complete})}static addRestaurantsFromAPI(){return fetch(DBHelper.DATABASE_URL).then(function(t){return t.json()}).then(t=>(DBHelper.saveToDatabase(t),t))}static getStoredRestaurants(){return DBHelper.openDatabase().then(function(t){if(t)return t.transaction("restaurantDbs").objectStore("restaurantDbs").getAll()})}static fetchRestaurants(t){return DBHelper.getStoredRestaurants().then(t=>t.length?Promise.resolve(t):DBHelper.addRestaurantsFromAPI()).then(e=>{t(null,e)}).catch(e=>{t(e,null)})}static fetchRestaurantById(t,e){DBHelper.fetchRestaurants((a,r)=>{if(a)e(a,null);else{const a=r.find(e=>e.id==t);a?e(null,a):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((a,r)=>{if(a)e(a,null);else{const a=r.filter(e=>e.cuisine_type==t);e(null,a)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((a,r)=>{if(a)e(a,null);else{const a=r.filter(e=>e.neighborhood==t);e(null,a)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,a){DBHelper.fetchRestaurants((r,n)=>{if(r)a(r,null);else{let r=n;"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),a(null,r)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,a)=>{if(e)t(e,null);else{const e=a.map((t,e)=>a[e].neighborhood),r=e.filter((t,a)=>e.indexOf(t)==a);t(null,r)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,a)=>{if(e)t(e,null);else{const e=a.map((t,e)=>a[e].cuisine_type),r=e.filter((t,a)=>e.indexOf(t)==a);t(null,r)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return t.photograph?`/img/${t.photograph}.jpg`:`/img/${t.id}.jpg`}static smallImageUrlForRestaurant(t){return t.photograph?`/img/small-${t.photograph}.jpg`:`/img/small-${t.id}.jpg`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
